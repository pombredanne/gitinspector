<div>
  <div class="box">

    <div style="width: 20px; position: absolute">
      <div id="remains_div" class="git2 visible">
	Remains Output
      </div>
    </div>

    <div id="remains_box"
	 style="display: flex; align-items: center">

      <div style="width:75%">
        <table id="remains_table" style="width: 100%" class="git2">
          <thead>
            <tr>
              <th/>
              <th>Author</th>
              <th>Rows</th>
              <th>Stability</th>
              <th>Age</th>
              <th>% of comments</th>
              <th/>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <th class="hoverable" colspan="7">
                Display minor authors
              </th>
            </tr>
          </tfoot>
        </table>
      </div>

      <div>
        <svg id="remains_svg" width="290" height="220">
        </svg>
      </div>

    </div>

    <script>

      var remains_data = $remains_data;
      var sum_rows = 0, eff_rows = 0;
      for (var i = 0; i < remains_data.length; i++)
          sum_rows += remains_data[i].rows;
      for (var i = 0; i < remains_data.length; i++)
          if (remains_data[i].rows > 0.01 * sum_rows)
	      eff_rows += remains_data[i].rows;
      var remains_data_pie = remains_data.filter(function (d) {
	  return d.rows > 0.01 * sum_rows; });
      // append the remaining changes as the last element of the pie
      remains_data_pie.push({rows: sum_rows-eff_rows});

      var titles = Object.keys(remains_data[0]);

      var svg = d3.select("svg#remains_svg"),
          width = svg.attr("width"),
          height = svg.attr("height"),
          radius = Math.min(width, height) / 2,
          g = svg.append("g").attr("transform",
                                   "translate(" + width / 2 + "," + height / 2 + ")"),
	  tbody = d3.select("table#remains_table tbody");

      var color = d3.scaleOrdinal(d3.schemeCategory10);

      // Generator for the pie
      var pie_maker = d3.pie().value(function(d) { return d.rows; });

      // Generator for the arcs
      var arc_maker = d3.arc()
          .innerRadius(radius/2.5)
          .outerRadius(radius);

      // Generate groups
      var arcs = g.selectAll("arc")
          .data(pie_maker(remains_data_pie))
          .enter()
          .append("g")
          .attr("class", "arc");

      // Draw arc paths
      arcs.append("path")
	  .attr("id", function(d, i) { return "path_" + i; })
	  .attr("fill", function(d, i) { return color(i); })
	  .attr("stroke", "white")
	  .attr("d", arc_maker);

      // Create lines of table
      var lines = tbody.selectAll()
          .data(remains_data)
          .enter()
          .append("tr")
          .attr("id", function (d,i) { return "line_" + i; });

      // Fill the lines with data
      titles.forEach(function (t) {
          lines.append("td").html(function(d) { return d[t]; });
      });
      lines.append("td").filter(function(d, i) { return d["rows"] > 0.01 * sum_rows; })
              .append("svg")
              .attr("width", 30).attr("height", 30)
              .append("rect")
              .attr("x", 5).attr("y", 5)
              .attr("width", 15).attr("height", 15)
              .attr("fill", function(d,i) { return color(i); });


      // Make the div hideable
      d3.select("div#remains_div").on("click", function () {
          if (this.className == "git2 visible") {
	      d3.select("div#remains_box").style("display", "none");
	      d3.select(this).style("transform", "rotate(0deg) translate(-50px,-15px)");
	      this.className = "git2";
	  } else {
	      d3.select("div#remains_box").style("display", "flex");
	      d3.select(this).style("transform", "rotate(90deg) translate(-10px,10px)");
	      this.className = "git2 visible";
	  }
      });

    </script>

  </div>
</div>
